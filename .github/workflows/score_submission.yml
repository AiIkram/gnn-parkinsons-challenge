name: Score Submission

on:
  pull_request:
    paths:
      - 'submissions/inbox/**'

jobs:
  score:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.8'
    
    - name: Install dependencies
      run: |
        pip install pandas scikit-learn numpy
    
    - name: Validate and Score
      env:
        TEST_LABELS: ${{ secrets.TEST_LABELS }}
      run: |
        echo "$TEST_LABELS" > /tmp/ground_truth.csv
        python competition/evaluate.py \
          --submission submissions/inbox/**/predictions.csv \
          --ground_truth /tmp/ground_truth.csv \
          --test_nodes data/public/test_nodes.csv
    
    - name: Comment Score
      uses: actions/github-script@v6
      with:
        script: |
          const fs = require('fs');
          github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: 'Submission scored! Check logs for results.'
          });